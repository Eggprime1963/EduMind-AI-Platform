# Production Configuration for Spring Boot

# Server Configuration
server.port=${PORT:8080}
server.servlet.context-path=/
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

# Database Configuration (Railway MySQL)
# Use Railway's provided environment variables with actual values
spring.datasource.url=${MYSQL_URL:jdbc:mysql://mysql.railway.internal:3306/railway?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&autoReconnect=true&failOverReadOnly=false&maxReconnects=10}
spring.datasource.username=${MYSQLUSER:root}
spring.datasource.password=${MYSQL_ROOT_PASSWORD:NbwmIiqbiLkVZErKAJVycTiMhXiLYJgu}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection Pool
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.pool-name=SpringBootJPAHikariCP
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1

# JPA/Hibernate (MySQL optimized for Railway)
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.connection.characterEncoding=utf8
spring.jpa.properties.hibernate.connection.CharSet=utf8
spring.jpa.properties.hibernate.connection.useUnicode=true
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=always
# Don't fail startup if database is not available
spring.jpa.generate-ddl=false
spring.jpa.open-in-view=false
# Continue initialization even with database issues
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect

# Logging
logging.level.root=INFO
logging.level.tech.nguyenstudy0504.learningplatform=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# Static Resources (for React frontend)
spring.web.resources.static-locations=classpath:/static/
spring.web.resources.cache.cachecontrol.max-age=31536000

# Actuator for health checks and monitoring
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
management.metrics.export.simple.enabled=true
management.endpoints.web.base-path=/actuator
management.endpoint.health.enabled=true

# Configure mail health check - only enable if EMAIL_USERNAME is provided
management.health.mail.enabled=${EMAIL_HEALTH_CHECK_ENABLED:false}

# CORS for development (Railway will handle production CORS)
spring.web.cors.allowed-origins=${ALLOWED_ORIGINS:*}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# AI Configuration
gemini.api.key=${GEMINI_API_KEY:}
gemini.base.url=${GEMINI_BASE_URL:https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent}
ollama.api.url=${OLLAMA_BASE_URL:http://localhost:11434/api/generate}
ai.priority=${AI_PRIORITY:gemini-first}

# VNPay Configuration
vnpay.tmn.code=${VNPAY_TMN_CODE:}
vnpay.secret.key=${VNPAY_SECRET_KEY:}
vnpay.pay.url=${VNPAY_PAY_URL:https://sandbox.vnpayment.vn/paymentv2/vpcpay.html}
vnpay.return.url=${VNPAY_RETURN_URL:http://localhost:8080/payment/return}

# Security
jwt.secret=${JWT_SECRET:mySecretKey}
jwt.expiration=${JWT_EXPIRATION:86400000}

# Disable default Spring Security password generation
spring.security.user.password=
logging.level.org.springframework.boot.autoconfigure.security=INFO

# File Upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Email Configuration for password reset functionality
# Configure these environment variables in Railway dashboard for email to work
spring.mail.host=${EMAIL_HOST:smtp.gmail.com}
spring.mail.port=${EMAIL_PORT:587}
spring.mail.username=${EMAIL_USERNAME:}
spring.mail.password=${EMAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=${EMAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.starttls.enable=${EMAIL_SMTP_STARTTLS:true}
spring.mail.properties.mail.smtp.starttls.required=${EMAIL_SMTP_STARTTLS_REQUIRED:true}

# Email template configuration
spring.mail.default-encoding=UTF-8
spring.mail.test-connection=false
